import{u as ie,_ as Pe,P as ee,a as Ce,b as ke}from"./index-5072b23b.js";import{w as H,i as z,P as xe,g as Oe,m as Me,v as Le}from"./index-2cfd342e.js";import{g as Se,a as Te,b as Re,c as $e,d as Be}from"./order-cc374703.js";import{u as Ne,A as Ee,B as C,c as A,s as Ue,C as te,E as ze,o as p,a as I,b as c,g as y,e as Ae,w as m,F as $,h as D,G as k,n as se,t as x,i as B,d as De,H as J,I as F,l as ne,J as Fe,K as je,R as qe,L as Ge,O as He,P as Je,Q as We,S as Ye,T as Ke,U as Qe,W as Xe}from"./vendor-bc3e0ca2.js";function ae(i=16,s=!1){const a="abcdefghijklmnopqrstuvwxyz",e="1234567890",l=[],u=s?e:a,d=u.length;for(;l.length<i;){const f=u[Math.floor(Math.random()*d)];l.push(Math.random()>.5?f:f.toUpperCase())}return l.join("")}/*!
 * currency.js - v2.0.4
 * http://scurker.github.io/currency.js
 *
 * Copyright (c) 2021 Jason Wilson
 * Released under MIT license
 */var Ze={symbol:"$",separator:",",decimal:".",errorOnInvalid:!1,precision:2,pattern:"!#",negativePattern:"-!#",format:nt,fromCents:!1},oe=function(s){return Math.round(s)},W=function(s){return Math.pow(10,s)},et=function(s,a){return oe(s/a)*a},tt=/(\d)(?=(\d{3})+\b)/g,st=/(\d)(?=(\d\d)+\d\b)/g;function V(i,s){var a=this;if(!(a instanceof V))return new V(i,s);var e=Object.assign({},Ze,s),l=W(e.precision),u=q(i,e);a.intValue=u,a.value=u/l,e.increment=e.increment||1/l,e.useVedic?e.groups=st:e.groups=tt,this.s=e,this.p=l}function q(i,s){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,e=0,l=s.decimal,u=s.errorOnInvalid,d=s.precision,f=s.fromCents,v=W(d),h=typeof i=="number",w=i instanceof V;if(w&&f)return i.intValue;if(h||w)e=w?i.value:i;else if(typeof i=="string"){var P=new RegExp("[^-\\d"+l+"]","g"),T=new RegExp("\\"+l,"g");e=i.replace(/\((.*)\)/,"-$1").replace(P,"").replace(T,"."),e=e||0}else{if(u)throw Error("Invalid Input");e=0}return f||(e*=v,e=e.toFixed(4)),a?oe(e):e}function nt(i,s){var a=s.pattern,e=s.negativePattern,l=s.symbol,u=s.separator,d=s.decimal,f=s.groups,v=(""+i).replace(/^-/,"").split("."),h=v[0],w=v[1];return(i.value>=0?a:e).replace("!",l).replace("#",h.replace(f,"$1"+u)+(w?d+w:""))}V.prototype={add:function(s){var a=this.intValue,e=this.s,l=this.p;return V((a+=q(s,e))/(e.fromCents?1:l),e)},subtract:function(s){var a=this.intValue,e=this.s,l=this.p;return V((a-=q(s,e))/(e.fromCents?1:l),e)},multiply:function(s){var a=this.intValue,e=this.s;return V((a*=s)/(e.fromCents?1:W(e.precision)),e)},divide:function(s){var a=this.intValue,e=this.s;return V(a/=q(s,e,!1),e)},distribute:function(s){for(var a=this.intValue,e=this.p,l=this.s,u=[],d=Math[a>=0?"floor":"ceil"](a/s),f=Math.abs(a-d*s),v=l.fromCents?1:e;s!==0;s--){var h=V(d/v,l);f-- >0&&(h=h[a>=0?"add":"subtract"](1/v)),u.push(h)}return u},dollars:function(){return~~this.value},cents:function(){var s=this.intValue,a=this.p;return~~(s%a)},format:function(s){var a=this.s;return typeof s=="function"?s(this,a):a.format(this,Object.assign({},a,s))},toString:function(){var s=this.intValue,a=this.p,e=this.s;return et(s/a,e.increment).toFixed(e.precision)},toJSON:function(){return this.value}};function j(i=0){var e;const a=((e=ie().userConfig)==null?void 0:e.currency_symbol)??"¥";return V(i,{fromCents:!0,symbol:a}).format()}const L=i=>(Qe("data-v-0224281b"),i=i(),Xe(),i),at={key:0,class:"plan-container"},it=L(()=>c("div",{class:"title-bar"},"1.确认充值账户",-1)),ot={class:"form-container"},rt={class:"form-item"},ct=L(()=>c("div",{class:"form-label"},"邮箱",-1)),lt={class:"form-content"},ut=L(()=>c("div",{class:"title-tip"},"我们不会与任何第三方分享您的电子邮件地址，并且仅在必要时联系您以确保服务质量或通知。",-1)),dt=L(()=>c("div",{class:"title-bar"},"2.选择适合方案",-1)),pt={class:"plan-cards"},_t=["onClick"],mt={class:"tit"},ft={class:"subtit"},vt=["innerHTML"],ht={class:"desc"},gt={class:"scroller"},yt={key:0,class:"bar"},bt={key:1,class:"tip"},wt={class:"checked"},It=L(()=>c("div",{class:"title-bar",style:{"margin-top":"40px"}},"3.支付方式",-1)),Vt={class:"payment-cards"},Pt=["onClick"],Ct=["src"],kt={class:"tit"},xt={class:"form-item",style:{"margin-top":"40px"}},Ot=L(()=>c("div",{class:"form-label"},"抵扣金额",-1)),Mt={class:"form-content"},Lt={class:"title-tip coupon-info"},St={key:0,class:"plan-buttons"},Tt={class:"pay-modal"},Rt={class:"pm-icon"},$t=L(()=>c("div",{class:"pm-tip"},"已付款切勿点击取消，支付到账需要1-2分钟，刷新此页面即可。",-1)),O="|",Bt={__name:"Plan",setup(i){const s=!(window.screen.width>=768),a=ie(),e=Ne(),l=Ee({planId:"",paymentId:""}),u=C(""),d=C([]),f=C([]),v=C(!1),h=C(""),w=C(1),P=C(0),T=C(!1);let N=0;const M=A(()=>d.value.find(t=>t.id===l.planId)),re=A(()=>{var g;const t=(g=M.value)==null?void 0:g.comboList.find(o=>{var R;return o.value===((R=M.value)==null?void 0:R.comboValue)}),n=(t==null?void 0:t.price)||0,r=w.value===1?n-P.value:n*(1-P.value/100);return j(r>0?r:0)}),ce=A(()=>{var r;const t=(r=M.value)==null?void 0:r.comboList.find(g=>{var o;return g.value===((o=M.value)==null?void 0:o.comboValue)}),n=w.value===1?P.value:((t==null?void 0:t.price)||0)*(P.value/100);return j(n||0)}),le=A(()=>{const t=[];if(s)for(let n=0;n<d.value.length;n++){const r=[];d.value[n]&&r.push(d.value[n]),t.push(r)}else for(let n=0;n<d.value.length;n+=2){const r=[];d.value[n]&&r.push(d.value[n]),d.value[n+1]&&r.push(d.value[n+1]),t.push(r)}return t});Ue(async()=>{T.value=!1,await ue(),await fe(),await me(),T.value=!0});async function ue(){const n=(await H(Oe)).data??[],r=n.filter(o=>!z(o.month_price)&&!z(o.half_year_price)&&!z(o.year_price)),g=n.filter(o=>!z(o.onetime_price)).slice(0,4);d.value=r.map(o=>({id:ae(12),title:"`${name}`",subTitle:(o.transfer_enable>1e4?"无限流量":o.transfer_enable+"GB流量")+"、全球节点",comboValue:o.id+O+"month_price",isOnetime:!1,comboList:[{value:o.id+O+"month_price",label:"1月",price:o.month_price,perMonth:o.month_price},{value:o.id+O+"half_year_price",label:"6月",price:o.half_year_price,perMonth:o.half_year_price/6},{value:o.id+O+"year_price",label:"12月",price:o.year_price,perMonth:o.year_price/12}]})),g.length>0&&(console.log("flexibles",g),d.value.push({id:ae(12),title:"按量",subTitle:"有限流量、永久有效",tip:"流量用尽时套餐失效",comboValue:g[0].id+O+"onetime_price",isOnetime:!0,comboList:g.map(o=>({value:o.id+O+"onetime_price",label:o.transfer_enable+"GB",price:o.onetime_price}))})),Y(d.value[0])}function de(t){const n=t.comboList.findIndex(r=>r.value===t.comboValue);if(n===0)return"8.33%";if(n===1)return"50%";if(n===2)return"100%"}function pe(t){const n=parseInt((1-t.comboList[2].price/(t.comboList[0].price*12))*100)+"%";return t.isOnetime?"流量永久有效":`按年付費可節省${n}費用`}function _e(t){const n=t.comboList.find(r=>r.value===t.comboValue);return t.isOnetime?j(n.price):j(n.perMonth)+"<small>/月</small>"}function Y(t){l.planId=t.id,P.value=0,h.value=""}function K(t){l.paymentId=t.id,ne.set(ee,t.id)}async function me(){const n=((await H(Te)).data??[]).find(r=>r.status===xe.WAIT_PAY);n&&(u.value=n.trade_no,v.value=!0,G())}async function fe(){const t=await H(Re);f.value=t.data??[],f.value.length>0&&K(f.value[0])}async function ve(){const t=M.value.comboValue.split(O),n=t[0],r=t[1],g=await Me({plan_id:n,period:r,coupon_code:h.value||""});g.data&&(u.value=g.data,v.value=!0,G())}function G(){N=setTimeout(()=>{u.value&&Se(u.value).then(t=>{Number(t.data)===3?(clearTimeout(N),te.success("购买成功"),v.value=!1,e.replace("/profile?refresh=1")):G()})},3e3)}async function he(){const t=await $e(u.value,ne.get(ee)||l.paymentId);if(t.type===1){const n=t.data;window.location.href=n}else t.type===0?(clearTimeout(N),e.push({path:"/payqr",query:{img:encodeURIComponent(t.data),orderId:u.value}})):t.type}async function ge(){(await Be(u.value)).data===!0&&(clearTimeout(N),te.success("已取消"),v.value=!1,u.value="")}async function ye(){try{if(!h.value)return this.$notification.error({message:"提示",description:"请输入优惠券"});const n=M.value.comboValue.split(O)[0],r=await Le({code:h.value,plan_id:n});w.value=r.data.type||1,r.data.value&&(r.data.limit_plan_ids===null||r.data.limit_plan_ids.includes(String(n)))?P.value=r.data.value:(P.value=0,this.$notification.error({message:"提示",description:"无效的优惠券"}))}catch{}}return(t,n)=>{const r=Fe,g=je,o=Ce,R=qe,be=Ge,Q=He,X=Je,we=We,E=Ye,Ie=ke,Ve=Ke,U=ze("wave");return p(),I($,null,[T.value?(p(),I("div",at,[it,c("div",ot,[c("div",rt,[ct,c("div",lt,[y(r,{value:Ae(a).userInfo.email,class:"form-input",maxlength:64,readonly:"",placeholder:"请输入邮箱"},null,8,["value"])])]),ut]),y(g),dt,c("div",pt,[y(we,{arrows:"",dots:!1,infinite:!1},{prevArrow:m(()=>[y(o,{name:"caret-left",size:"50px",color:"#000"})]),nextArrow:m(()=>[y(o,{name:"caret-right",size:"50px",color:"#000"})]),default:m(()=>[(p(!0),I($,null,D(le.value,(b,Z)=>(p(),I("div",{key:Z,class:"plan-slide"},[y(X,{gutter:[25,25]},{default:m(()=>[(p(!0),I($,null,D(b,_=>(p(),k(Q,{key:_.id,md:12,xs:24},{default:m(()=>[c("div",{class:se(["plan-card",{"is-active":_.id===l.planId,"is-period":!_.isOnetime}]),onClick:S=>Y(_)},[c("div",mt,x(_.title),1),c("div",ft,x(_.subTitle),1),c("div",{class:"price",innerHTML:_e(_)},null,8,vt),c("div",ht,x(pe(_)),1),c("div",gt,[y(be,{value:_.comboValue,"onUpdate:value":S=>_.comboValue=S,class:"combo"},{default:m(()=>[(p(!0),I($,null,D(_.comboList,S=>(p(),k(R,{key:S.value,value:S.value},{default:m(()=>[B(x(S.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_.isOnetime?J("",!0):(p(),I("div",yt,[c("div",{class:"in",style:De({width:de(_)})},null,4)])),_.tip?(p(),I("div",bt,x(_.tip),1)):J("",!0),c("div",wt,[y(o,{name:"check"})])],10,_t)]),_:2},1024))),128))]),_:2},1024)]))),128))]),_:1})]),It,c("div",Vt,[y(X,{gutter:[25,25]},{default:m(()=>[(p(!0),I($,null,D(f.value,b=>(p(),k(Q,{key:b.id,md:12,xs:24},{default:m(()=>[c("div",{class:se(["payment-card",{"is-active":b.id===l.paymentId}]),onClick:Z=>K(b)},[c("img",{class:"icon",src:b.icon},null,8,Ct),c("div",kt,x(b.name),1),y(R,{class:"check",checked:b.id===l.paymentId},null,8,["checked"])],10,Pt)]),_:2},1024))),128))]),_:1})]),c("div",xt,[Ot,c("div",Mt,[y(r,{value:h.value,"onUpdate:value":n[0]||(n[0]=b=>h.value=b),class:"form-input control-input",maxlength:64,placeholder:"有优惠劵？"},{suffix:m(()=>[F((p(),k(E,{type:"primary",size:"small",shape:"round",onClick:ye},{default:m(()=>[B("验证")]),_:1})),[[U]])]),_:1},8,["value"])])]),c("div",Lt,"折扣金额 -"+x(ce.value),1),M.value?(p(),I("div",St,[F((p(),k(E,{type:"primary",shape:"round",onClick:ve},{default:m(()=>[B(x(re.value)+" 立即购买",1)]),_:1})),[[U]])])):J("",!0)])):(p(),k(Ie,{key:1})),y(Ve,{open:v.value,"onUpdate:open":n[1]||(n[1]=b=>v.value=b),footer:null,centered:"",width:"380px",maskClosable:!1,closable:!1},{default:m(()=>[c("div",Tt,[c("div",Rt,[y(o,{name:"warning-circle",weight:"fill"})]),$t,F((p(),k(E,{type:"primary",class:"pm-btn",onClick:he},{default:m(()=>[B("点击支付")]),_:1})),[[U]]),F((p(),k(E,{type:"primary",class:"pm-btn",ghost:"",onClick:ge},{default:m(()=>[B("取消")]),_:1})),[[U]])])]),_:1},8,["open"])],64)}}},At=Pe(Bt,[["__scopeId","data-v-0224281b"]]);export{At as default};
