import{u as P,B as i,A as V,c as f,s as $,l as d,a1 as R,r as G,E as O,o as _,a as A,g as s,w as o,I as F,G as T,i as w,t as J,b as h,e as H,a2 as B,C as D,J as K,a3 as Q,S as W,a5 as X,T as Y,a6 as Z}from"./vendor-bc3e0ca2.js";import{u as ee,L as ae}from"./index-5072b23b.js";import{s as te,r as se,a as oe}from"./auth-ff21b30d.js";const le={class:"auth-container"},ne={class:"btns"},re={class:"bottom",style:{"justify-content":"center"}},ie=h("div",{id:"recaptcha",style:{height:"80px"}},null,-1),m="FindTime",pe={__name:"ResetPassword",setup(ce){const b=ee(),z=P(),p=i(null),v=i(!1),g=i(!1),c=i(!1),r=i(0),a=V({email:"",emailCode:"",password:"",captchaData:""}),I=f(()=>q()),M=f(()=>b.globalConfig.is_recaptcha===1),S=f(()=>b.globalConfig.recaptcha_site_key);$(()=>{const t=d.get(m);if(t){const e=60-(R().valueOf()-t)/1e3;e>0?y(e):d.remove(m)}});function q(){return{email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"邮箱格式错误",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:8,message:"密码至少为8个字符",trigger:"blur"}],emailCode:[{required:!0,message:"请输入验证码",trigger:"blur"}]}}function y(t){r.value=t;const e=setInterval(()=>{r.value--,r.value<=0&&(clearInterval(e),d.remove(m))},1e3)}function E(){c.value=!0,Z(()=>{oe(["https://www.google.com/recaptcha/api.js?onload=onloadCallback2&render=explicit"],"google-recaptcha2"),window.onloadCallback2=()=>{const t=window.grecaptcha.render("recaptcha",{sitekey:S.value,callback:()=>{c.value=!1,a.captchaData=window.grecaptcha.getResponse(t),window.grecaptcha.reset(t),C(null,!0)}})}})}async function C(t,e){const{email:l}=B(a);if(await p.value.validate(["email"]),M.value&&!e){E();return}g.value=!0;try{(await te({email:l,recaptcha_data:a.captchaData})).data===!0&&(D.success("验证码发送成功，如未收到请检查垃圾邮件"),d.set(m,R().valueOf()),y(60))}catch{}g.value=!1}async function L(){const{email:t,password:e,emailCode:l}=B(a);await p.value.validate(),v.value=!0;try{await se({email:t,password:e,email_code:l}),D.success("密码重置成功，请登录"),z.push("/login")}catch{}v.value=!1}return(t,e)=>{const l=K,u=Q,k=W,U=G("router-link"),j=X,N=Y,x=O("wave");return _(),A("div",le,[s(j,{ref_key:"refForm",ref:p,class:"auth-form",model:a,rules:I.value,hideRequiredMark:"",colon:!1,layout:"vertical",onFinish:L},{default:o(()=>[s(u,{class:"control-item",label:"邮箱",name:"email"},{default:o(()=>[s(l,{value:a.email,"onUpdate:value":e[0]||(e[0]=n=>a.email=n),class:"control-input",size:"large",placeholder:"请输入邮箱","allow-clear":""},null,8,["value"])]),_:1}),s(u,{class:"control-item",label:"验证码",name:"emailCode"},{default:o(()=>[s(l,{value:a.emailCode,"onUpdate:value":e[2]||(e[2]=n=>a.emailCode=n),class:"control-input",size:"large",maxlength:32,placeholder:"请输入验证码"},{suffix:o(()=>[F((_(),T(k,{type:"primary",loading:g.value,disabled:r.value>0,class:"btn-vcode",shape:"round",size:"small",onClick:e[1]||(e[1]=n=>C())},{default:o(()=>[w(J(r.value>0?`${parseInt(r.value)}s`:"发送"),1)]),_:1},8,["loading","disabled"])),[[x]])]),_:1},8,["value"])]),_:1}),s(u,{class:"control-item",label:"密码",name:"password"},{default:o(()=>[s(l,{value:a.password,"onUpdate:value":e[3]||(e[3]=n=>a.password=n),class:"control-input",type:"password",size:"large",maxlength:64,placeholder:"请输入密码","allow-clear":""},null,8,["value"])]),_:1}),h("div",ne,[F((_(),T(k,{type:"primary",class:"btn",loading:v.value,size:"large",htmlType:"submit"},{default:o(()=>[w("重置密码")]),_:1},8,["loading"])),[[x]])]),h("div",re,[s(U,{class:"link",to:"/login"},{default:o(()=>[w("登录")]),_:1})]),s(H(ae),{class:"logo"})]),_:1},8,["model","rules"]),s(N,{open:c.value,centered:"",footer:null,onCancel:e[4]||(e[4]=n=>c.value=!1)},{default:o(()=>[ie]),_:1},8,["open"])])}}};export{pe as default};
